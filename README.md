# Monitoring System

Реализация проекта системы мониторинга.


## Contents

1. [Chapter I](#chapter-i) \
    1.1. [Introduction](#introduction)
2. [Chapter II](#chapter-ii) \
    2.1. [Information](#information)
3. [Chapter III](#chapter-iii) \
    3.1. [Part 1](#part-1-реализация-системы-мониторинга) \
    3.2. [Part 2](#part-2-оповещения) \
    3.3. [Part 3](#part-3-дополнительно-реализация-агента-со-специальными-метриками) 


## Chapter I

## Introduction

В данном проекте вам необходимо реализовать программу для простого мониторинга основных показателей системы виде ядра и агентов. Агенты должны будут собирать метрики и передавать их ядру, который логирует данные метрики. При достижении критических значений, система должна отправлять уведомления пользователю.


## Chapter II

## Information

**Системы мониторинга** - это обслуживающие системы постоянного наблюдения. В программной среде, такая система является метасистемой, то есть  надстройкой над некоторой системой, которая ее описывает. Мониторинг программных систем подразумевает *логирование* или *журналирование* и сбор конкретных *метрик*. Метрики сообщают вам, сколько чего-то существует, например, сколько памяти доступно в компьютерной системе или сколько сантиметров имеет длина рабочего стола. Это является основополагающим свойством метрики - ее исчислимость. В нашем случае метрики собираемые системой мониторинга, относятся к программе, программному комплексу и/или окружению, над которыми производится наблюдение. \
*Критическими значениями* метрики называется область числовой прямой значений метрики, при достижении которой система должна выдать оповещение системному администратору. Это, очевидно, является очень полезным дополнением, позволяющим системному администратору, вместо того, чтобы смотреть на значения метрик круглые сутки, получать автоматически уведомления о критических для него значениях метрик. Это может быть, например, 95% заполненности жесткого диска, что означает, что администратору следует произвести очистку компьютера.

В данной работе, вам не придется отслеживать состояние какого-либо специального программного комплекса, вместо этого вам предстоит отслеживать состояние конкретных метрик вашей операционной системы. \
*Журналирование* подразумевает запись *логов* или *журнальных записей* исполняемого программного обеспечения в отдельный текстовый файл. Это могут быть, как и уже хорошо знакомые вам, строчки для debug'а, так и сообщения об ошибках выполнения программы или о прохождении ее ключевых этапов. В нашем случае, логи операционной системы не будут отслеживаться.

В подавляющем большинстве случаев существующего программного обеспечения (*Zabbix*, *Grafana*, *Nagios* и т.д.), система мониторинга представляет из себя некоторое ядро, концентрирующее в себе актуальные значения метрик (обычно в специальной нереляционной базе данных) и программ-агентов, осуществляющих сбор конкретных метрик (обычно они логически разделены, например агент, работающий с метриками процессора, агент работающий с метриками аккумулятора и т.д.). Агенты представляют из себя легковесные программы, работающие в фоновом режиме и собирающие актуальные значения метрик в указанный в некотором конфигурационном файле промежуток времени. \
В качестве агента в данной работе предлагается использовать динамические библиотеки (*.so), например, с методом `updateMetrics()`, позволяющим подгружать актуальные значения метрик, собираемые этим агентом-библиотекой. Важно, чтобы агентов могло быть не только произвольное количество, но и их можно было бы динамически подключать/отключать во время работы ядра системы мониторинга. Например, при помощи загрузки новых агентов в некоторый каталог `./agents/`. Вместо базы данных с метриками предлагается использовать единый лог-файл для всей системы мониторинга, в который периодически раз в указанное в конфигурационном файле время записывается список с актуальными значениями метрик в следующем виде:

```
[<TIMESTAMP>] | <Metric1> : <Value1> |  <Metric2> : <Value2> |  <Metric3> : <Value3> | ...

```

- \<TIMESTAMP\> - временная метка в формате `yy-MM-dd HH:mm:ss`

- \<MetricN\> - N-ная метрика

- \<ValueN\> - значение N-ной метрики


## Chapter III

## Part 1. Реализация системы мониторинга

- Программа должна быть разработана на языке C++ стандарта C++17
- Код программы должен находиться в папке src
- Сборка программы должна быть настроена с помощью Makefile со стандартным набором целей для GNU-программ: all, install, uninstall, clean, dvi, dist, tests. Установка должна вестись в любой другой произвольный каталог
- Классы должны быть реализованы внутри пространства имен `s21`
- Подготовить полное покрытие unit-тестами модулей, реализующих бизнес-логику приложения, c помощью библиотеки GTest
- Реализация с графическим пользовательским интерфейсом, на базе любой GUI-библиотеки с API для C++17: Qt, SFML, GTK+, Nanogui, Nngui и т. д.
- Программа должна быть реализована с использованием паттерна MVC, а также:
    - не должно быть кода бизнес-логики в коде представлений
    - не должно быть кода интерфейса в контроллере и в модели
    - контроллеры должны быть тонкими
- Программа должна состоять из ядра и агентов, ядро должно периодически осуществлять вызов соотвествующих методов подключенных к нему агентов (динамические библиотеки в папке `./agents/`) и записывать актуальные метрики в виде списка в журнал системы мониторинга в папке `./logs/`. 
- На каждый день работы системы мониторинга создается отдельный файл журнала. Файл журнала должен иметь название полной даты того дня, в который он был создан. 
- Программа-ядро в **отдельном потоке** должна с заданной периодичностью в несколько секунд сканировать папку `./agents/` на наличие *новых* агентов, которых необходимо подключить к системе и отобразить в интерфейсе.
- Сборка новых агентов должна осуществляться через отдельный сценарий makefile'а, настройка агентов должна осуществляться через конфигурационный файл, прилагающийся к коду агента. При инициализации, агент должен считать актуальный конфигурационный файл и сохранить настройки до конца выполнения программы или до их изменения пользователем.
- Конфигурационный файл должен предоставлять возможность изменять:
    - имя агента
    - тип агента
    - список критических значений метрик
    - время обновления метрик
- Необходимо предусмотреть как минимум три разных типа агентов:
    - Агент мониторинга загрузки CPU должен иметь возможность сбора следующих метрик:
        - `[double]` загрузка процессора (`cpu`)
        - `[int]` количество процессов (`processes`)
    - Агент мониторинга памяти должен иметь возможность сбора следующих метрик:
        - `[double]` общий объем оперативной памяти (`ram_total`)
        - `[double]` загрузка оперативной памяти в процентах (`ram`),
        - `[double]` использование объема жесткого диска (`hard_volume`),
        - `[int]` количество операций ввода-вывода для жесткого диска в секунду (`hard_ops`)
        - `[double]` пропускная способность жесткого диска (`hard_throughout`)
    - Агент мониторинга сети должен иметь возможность сбора следующих метрик:
        - `[int : 0 -> не доступен, 1 -> доступен]` доступность адреса (`<url>`)
        - `[double]` пропускная способность используемых сетевых интерфейсов (`inet_throughout`)
- В конфигурационном файле метрики указываются по имени на латинице (`cpu`, `ram`, `hard_volume`, `hard_ops`, `hard_throughout`, `processors`, `processes`) или через url для метрики доступности адреса. Для каждой метрики должна иметься возможность указать критическое значение через символ равенства/неравества и число (<, <=, ==, >=, >). Например: >=2, ==100, <50 и т.д.
- Интерфейс программы должен отображать:
    - последние 20 строк журнала, окно журнала должно динамически обновляться каждый раз, когда в журнал осуществляется запись
    - список подключенных агентов
- Интерфейс программы должен позволять:
    - получать подробную информацию об агенте:
        - тип агента 
        - список отслеживаемых метрик
        - время, прошедшее с момента старта агента
        - время обновления метрик
    - динамически изменять конфигурацию уже запущенного агента (с сохранением в конфигурационный файл)
    - отключать выбранного в списке агента

## Part 2. Оповещения

- Для отправки оповещения системному администратору о критической ситуации должен быть разработан простейший бот для Телеграма, отправляющий сообщение о достижении метрикой своего критического значения. Сообщение должно содержать имя компьютера (хоста), название метрики и ее значение. 
- Предусмотреть в интерфейсе возможность включать/выключать дублирование оповещений на указанный email адрес.
- Для реализации логики отправки сообщений в Телеграм и на почту разрешается использование любых внешних библиотек, работающих с Телеграмом и электронными письмами. 

## Part 3. Дополнительно. Реализация агента со специальными метриками.

Реализовать еще как минимум одного агента, собирающего дополнительные метрики:

- `[double]` загрузка процессора по уровням привелегий: `idle`, `user`, `priveleged`, `dpc`, `interrupt` (для каждого уровня выделить процент) (`cpu_idle_usage`, `cpu_user_usage`, ...)
- `[double]` общий объем свопа/swap'а (`total_swap`)
- `[double]` используемый объем свопа/swap'а (`used_swap`) 
- `[int]` количество готовых к выполнению процессов в очереди (при необходимости прочитать про состояния процессов в *Unix*) (`proc_queue_length`)
- `[double]` подсчет полной и свободной виртуальной памяти (`virtual_mem_volume`, `virtual_mem_free`)
- `[int]` общее число inode'ов (`inodes`)
- `[double]` среднее время чтения с жесткого диска (`hard_read_time`)
- `[int]` число ошибок из системного журнала (`system_errors`)
- `[int]` количество авторизаций пользователей (`user_auths`) 
